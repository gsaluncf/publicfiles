<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session 5: Simulation - Data Science in Wealth Management</title>
</head>
<body>

<nav style="background-color: #1e40af; padding: 12px 20px; margin: -8px -8px 20px -8px; border-radius: 0 0 8px 8px;">
    <a href="index.html" style="color: white; font-weight: bold; margin-right: 30px; text-decoration: none;">Home</a>
    <a href="00_seminar_framework.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Agenda</a>
    <a href="01_opening_presentation.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">1. Problem</a>
    <a href="03_data_model_presentation.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">2. Data Model</a>
    <a href="03b_stats_foundations.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">3. Why Simulate</a>
    <a href="04_statistical_methods.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">4. Math</a>
    <a href="05_monte_carlo_aggregation.html" style="color: #93c5fd; margin-right: 12px; text-decoration: none; font-weight: bold;">[5. Simulation]</a>
    <a href="06_aggregation_metrics.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">6. Analysis</a>
    <a href="07_real_world_complexity.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Real World</a>
    <a href="02_definitions_glossary.html" style="color: #dbeafe; text-decoration: none;">Glossary</a>
</nav>

<h1>Session 5: Building the Simulation</h1>
<p style="color: #64748b; font-style: italic;">Putting it all together with Monte Carlo</p>

<div style="background-color: #dbeafe; border: 1px solid #93c5fd; border-radius: 8px; padding: 20px; margin: 20px 0;">
<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 10px;">The Core Idea</h2>
<p style="font-size: 18px;">When a problem is too complex to solve analytically, we can <strong>simulate it thousands of times</strong> and study the distribution of outcomes.</p>
<p>This is Monte Carlo simulation: replace mathematical intractability with computational brute force.</p>
</div>

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">Why Can't We Just Calculate the Answer?</h2>

<p>Consider our RMD optimization problem. To calculate the optimal strategy directly, we would need to:</p>

<ol>
    <li>Know exactly when the person will die (we don't)</li>
    <li>Know exactly what the market will return each year (we don't)</li>
    <li>Account for the interaction between these two unknowns (complex)</li>
    <li>Handle the path-dependence of RMD calculations (each year depends on prior years)</li>
</ol>

<p>There is no closed-form solution. The math is intractable.</p>

<div style="background-color: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 20px; margin: 20px 0;">
<h3 style="color: #1d4ed8; margin-top: 5px;">The Monte Carlo Alternative</h3>
<p>Instead of solving the problem analytically, we:</p>
<ol>
    <li><strong>Generate 10,000 possible futures</strong> - random market paths + random lifespans</li>
    <li><strong>Apply our strategy to each future</strong> - calculate taxes, RMDs, terminal wealth</li>
    <li><strong>Analyze the distribution of outcomes</strong> - what's the average? The worst case? How often does Strategy A beat Strategy B?</li>
</ol>
<p>The law of large numbers guarantees that with enough simulations, our sample statistics converge to the true values.</p>
</div>

<hr style="border: 1px solid #cbd5e1; margin: 30px 0;">

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">A Simple Example: Estimating Pi</h2>

<p>Before we tackle finance, let's see Monte Carlo in action with a classic example.</p>

<p><strong>Problem:</strong> Estimate the value of π using random numbers.</p>

<p><strong>Method:</strong></p>
<ol>
    <li>Draw a square with side length 2, centered at origin</li>
    <li>Inscribe a circle with radius 1 inside it</li>
    <li>Throw random darts at the square</li>
    <li>Count how many land inside the circle</li>
</ol>

<p>The ratio of darts inside the circle to total darts approximates π/4.</p>

<pre style="background-color: #f1f5f9; border: 1px solid #cbd5e1; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 14px;">
import numpy as np

def estimate_pi(n_samples):
    # Random points in [-1, 1] x [-1, 1]
    x = np.random.uniform(-1, 1, n_samples)
    y = np.random.uniform(-1, 1, n_samples)

    # Count points inside unit circle
    inside = (x**2 + y**2) <= 1

    # Ratio * 4 = pi
    return 4 * np.sum(inside) / n_samples

# More samples = better estimate
print(f"100 samples: {estimate_pi(100):.4f}")
print(f"10,000 samples: {estimate_pi(10000):.4f}")
print(f"1,000,000 samples: {estimate_pi(1000000):.4f}")
print(f"Actual pi: {np.pi:.4f}")
</pre>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
<tr style="background-color: #1e40af; color: white;">
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Samples</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Estimate</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Error</th>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">100</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">3.12</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">0.7%</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px;">10,000</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">3.1416</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">0.01%</td>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">1,000,000</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">3.14159</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">0.0001%</td>
</tr>
</table>

<div style="background-color: #eff6ff; border: 1px solid #60a5fa; border-radius: 8px; padding: 15px; margin: 20px 0;">
<h3 style="color: #1d4ed8; margin-top: 5px;">The Key Insight</h3>
<p>We didn't need to know any geometry. We just threw random darts and counted. <strong>Monte Carlo converts hard math problems into easy counting problems.</strong></p>
</div>

<hr style="border: 1px solid #cbd5e1; margin: 30px 0;">

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">Applying Monte Carlo to Our Problem</h2>

<p>For the RMD optimization problem, our "random darts" are:</p>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
<tr style="background-color: #1e40af; color: white;">
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left; width: 30%;">Random Input</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left; width: 35%;">How We Generate It</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left; width: 35%;">What It Represents</th>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-weight: bold;">Market Path</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Geometric Brownian Motion with μ=7%, σ=16%</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">One possible 35-year market history</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-weight: bold;">Death Age</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Sample from SSA actuarial life tables</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">One possible lifespan</td>
</tr>
</table>

<p>For each simulation path, we:</p>
<ol>
    <li>Pair a random market path with a random death age</li>
    <li>Apply Strategy A (Hold to Death) and calculate terminal wealth</li>
    <li>Apply Strategy B (Aggressive Conversion) to the same path and calculate terminal wealth</li>
    <li>Record both results</li>
</ol>

<p>After 10,000 paths, we have 10,000 paired outcomes to analyze.</p>

<hr style="border: 1px solid #cbd5e1; margin: 30px 0;">

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">What Questions Can Simulation Answer?</h2>

<p>With 10,000 simulated outcomes, we can answer questions that are impossible to answer analytically:</p>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
<tr style="background-color: #1e40af; color: white;">
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Question</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">How Simulation Answers It</th>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">"Which strategy is better on average?"</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Compare mean terminal wealth across all paths</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px;">"What's the worst-case scenario?"</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Look at the 5th percentile of outcomes (VaR)</td>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">"How often does Strategy A beat Strategy B?"</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Count paths where A > B, divide by total paths</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px;">"At what volatility does the optimal strategy change?"</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Run simulations at different σ values, find crossover</td>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">"How confident are we in these results?"</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Calculate confidence intervals on our estimates</td>
</tr>
</table>

<hr style="border: 1px solid #cbd5e1; margin: 30px 0;">

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">The Simulation Pipeline</h2>

<p>Here's the architecture we'll build:</p>

<div style="background-color: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; padding: 20px; margin: 20px 0; font-family: 'Courier New', monospace;">
<pre style="margin: 0; font-size: 14px;">
┌─────────────────────────────────────────────────────────────────┐
│                     SIMULATION ENGINE                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │   Generate   │    │    Sample    │    │    Pair &    │       │
│  │ Market Paths │───▶│ Death Ages   │───▶│   Combine    │       │
│  │    (GBM)     │    │    (SSA)     │    │              │       │
│  └──────────────┘    └──────────────┘    └──────┬───────┘       │
│                                                  │               │
│                                                  ▼               │
│                                          ┌──────────────┐       │
│                                          │ Apply Tax    │       │
│                                          │ Strategies   │       │
│                                          └──────┬───────┘       │
│                                                  │               │
│                                                  ▼               │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │   Analyze    │◀───│    Store     │◀───│   Record     │       │
│  │   Results    │    │  in DuckDB   │    │   Outcomes   │       │
│  └──────────────┘    └──────────────┘    └──────────────┘       │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
</pre>
</div>

<h3 style="color: #1d4ed8; margin-top: 25px;">Why Store in a Database?</h3>

<p>With 10,000 paths and 2 strategies, we generate 20,000 result rows. Storing in DuckDB lets us:</p>
<ul>
    <li>Query results with SQL (familiar, powerful)</li>
    <li>Run different analyses without re-running simulations</li>
    <li>Join with other tables (e.g., filter by death age range)</li>
    <li>Persist results for later comparison</li>
</ul>

<div style="background-color: #eff6ff; border: 1px solid #60a5fa; border-radius: 8px; padding: 15px; margin: 20px 0;">
<h3 style="color: #1d4ed8; margin-top: 5px;">Next: Aggregation Metrics</h3>
<p>Once we have 10,000 simulation results, how do we turn them into decisions? <a href="06_aggregation_metrics.html" style="color: #1e40af; font-weight: bold;">Continue to Aggregation Metrics</a></p>
</div>

</body>
</html>

