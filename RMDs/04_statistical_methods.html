<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session 3: Statistical Methods for Tax-Optimized Simulation</title>
</head>
<body>

<nav style="background-color: #1e40af; padding: 12px 20px; margin: -8px -8px 20px -8px; border-radius: 0 0 8px 8px;">
    <a href="index.html" style="color: white; font-weight: bold; margin-right: 30px; text-decoration: none;">RMD Seminar</a>
    <a href="00_seminar_framework.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Framework</a>
    <a href="01_opening_presentation.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Opening</a>
    <a href="01b_problem_scenarios.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Scenarios</a>
    <a href="02_definitions_glossary.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Glossary</a>
    <a href="03_data_model_presentation.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Data Model</a>
    <a href="03b_stats_foundations.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Stats Intro</a>
    <a href="04_statistical_methods.html" style="color: #93c5fd; margin-right: 12px; text-decoration: none; font-weight: bold;">[Stats Methods]</a>
    <a href="05_monte_carlo_aggregation.html" style="color: #dbeafe; margin-right: 12px; text-decoration: none;">Monte Carlo</a>
    <a href="06_aggregation_metrics.html" style="color: #dbeafe; text-decoration: none;">Metrics</a>
</nav>

<h1>Session 3: Statistical Methods for Tax-Optimized Simulation</h1>
<p style="color: #64748b; font-style: italic;">The data science toolkit for wealth management simulation</p>

<div style="background-color: #dbeafe; border: 1px solid #93c5fd; border-radius: 8px; padding: 20px; margin: 20px 0;">
<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 10px;">Why Averages Fail</h2>
<p>The statement "the market returns 7% per year on average" is useless for retirement planning. Two portfolios with identical average returns can have wildly different outcomes depending on the <em>sequence</em> of returns and the <em>timing</em> of death.</p>
<p>This session introduces the statistical machinery needed to model uncertainty properly.</p>
</div>

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">Method 1: Geometric Brownian Motion (GBM)</h2>

<h3 style="color: #1d4ed8; margin-top: 25px;">What It Models</h3>
<p>GBM models the evolution of asset prices over time, capturing both expected growth and random volatility.</p>

<h3 style="color: #1d4ed8; margin-top: 25px;">The Mathematics</h3>
<div style="background-color: #f1f5f9; border: 1px solid #cbd5e1; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 5px; margin: 15px 0;">
<p style="font-family: 'Courier New', monospace; font-size: 16px; text-align: center;">
dS = μS dt + σS dW
</p>
</div>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
<tr style="background-color: #1e40af; color: white;">
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Symbol</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Name</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Interpretation</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Typical Value</th>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-family: 'Courier New', monospace;">S</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Stock price</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Current value of the asset</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">$100 (starting)</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-family: 'Courier New', monospace;">μ</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Drift</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Expected annual return</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">0.07 (7%)</td>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-family: 'Courier New', monospace;">σ</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Volatility</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Standard deviation of returns</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">0.16 (16%)</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-family: 'Courier New', monospace;">dW</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Wiener process</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Random shock ~ N(0, dt)</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Sampled each step</td>
</tr>
</table>

<h3 style="color: #1d4ed8; margin-top: 25px;">Discrete Implementation</h3>
<p>For simulation, we use the discrete form over annual time steps:</p>

<pre style="background-color: #f1f5f9; border: 1px solid #cbd5e1; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 14px;">
import numpy as np

def simulate_gbm_paths(S0, mu, sigma, T, n_paths, seed=42):
    """
    Generate n_paths of GBM over T years.
    
    Parameters:
    -----------
    S0 : float - Initial price
    mu : float - Annual drift (expected return)
    sigma : float - Annual volatility
    T : int - Number of years
    n_paths : int - Number of simulation paths
    
    Returns:
    --------
    np.ndarray of shape (n_paths, T+1) - Price paths
    """
    np.random.seed(seed)
    dt = 1.0  # Annual steps
    
    # Generate random shocks
    Z = np.random.standard_normal((n_paths, T))
    
    # Calculate log returns
    log_returns = (mu - 0.5 * sigma**2) * dt + sigma * np.sqrt(dt) * Z
    
    # Build price paths
    paths = np.zeros((n_paths, T + 1))
    paths[:, 0] = S0
    paths[:, 1:] = S0 * np.exp(np.cumsum(log_returns, axis=1))
    
    return paths
</pre>

<div style="background-color: #eff6ff; border: 1px solid #60a5fa; border-radius: 8px; padding: 15px; margin: 20px 0;">
<h3 style="color: #1d4ed8; margin-top: 5px;">Key Insight</h3>
<p>With μ=0.07 and σ=0.16, after 30 years the <strong>median</strong> outcome is about 7.6x the starting value. But the 5th percentile is only 1.8x, while the 95th percentile is 32x. Same parameters, vastly different outcomes.</p>
</div>

<hr style="border: 1px solid #cbd5e1; margin: 30px 0;">

<h2 style="color: #1e40af; border-left: 4px solid #3b82f6; padding-left: 15px; margin-top: 30px;">Method 2: Survival Analysis</h2>

<h3 style="color: #1d4ed8; margin-top: 25px;">What It Models</h3>
<p>Survival analysis models the probability distribution of "time until event" - in our case, time until death. We use actuarial life tables published by the Social Security Administration.</p>

<h3 style="color: #1d4ed8; margin-top: 25px;">Key Functions</h3>

<table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
<tr style="background-color: #1e40af; color: white;">
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Function</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Definition</th>
    <th style="border: 1px solid #cbd5e1; padding: 12px; text-align: left;">Use in Simulation</th>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-weight: bold;">Survival Function S(t)</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">P(T > t) = probability of surviving past age t</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Determines when step-up in basis occurs</td>
</tr>
<tr style="background-color: #f8fafc;">
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-weight: bold;">Hazard Function h(t)</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Instantaneous risk of death at age t, given survival to t</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Increases with age (mortality acceleration)</td>
</tr>
<tr>
    <td style="border: 1px solid #cbd5e1; padding: 12px; font-weight: bold;">Life Expectancy E[T|t]</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Expected remaining years of life at age t</td>
    <td style="border: 1px solid #cbd5e1; padding: 12px;">Used in RMD divisor calculations</td>
</tr>
</table>

<h3 style="color: #1d4ed8; margin-top: 25px;">Sampling from Life Tables</h3>

<pre style="background-color: #f1f5f9; border: 1px solid #cbd5e1; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', monospace; font-size: 14px;">
import numpy as np
from scipy import interpolate

def sample_death_ages(current_age, n_samples, life_table, seed=42):
    """
    Sample death ages from actuarial life table.
    
    Parameters:
    -----------
    current_age : int - Starting age
    n_samples : int - Number of samples to draw
    life_table : dict - {age: survival_probability} from SSA
    
    Returns:
    --------
    np.ndarray - Sampled death ages
    """
    np.random.seed(seed)
    
    # Build CDF from survival probabilities
    ages = np.array(sorted(life_table.keys()))
    survival_probs = np.array([life_table[a] for a in ages])
    
    # Normalize to conditional survival (given alive at current_age)
    idx = np.searchsorted(ages, current_age)
    conditional_survival = survival_probs[idx:] / survival_probs[idx]
    conditional_ages = ages[idx:]
    
    # Invert CDF to sample
    uniform_samples = np.random.uniform(0, 1, n_samples)
    death_ages = np.interp(uniform_samples, 1 - conditional_survival, conditional_ages)
    
    return np.floor(death_ages).astype(int)
</pre>

<div style="background-color: #eff6ff; border: 1px solid #60a5fa; border-radius: 8px; padding: 15px; margin: 20px 0;">
<h3 style="color: #1d4ed8; margin-top: 5px;">Next: Why Simulation?</h3>
<p>Now that you understand the statistical models, let's see why Monte Carlo simulation is the right approach for this problem. <a href="05_monte_carlo_aggregation.html" style="color: #1e40af; font-weight: bold;">Continue to Monte Carlo</a></p>
</div>

</body>
</html>

